# Chuyển đổi Chat Widget thành Trợ lý AI cho Merchant (Đã kiểm tra độc lập)

## Kết quả kiểm tra
*   **ChatWidget.tsx**: Chỉ được sử dụng trong `Layout.tsx` (Dashboard của Merchant).
*   **EmbeddableWidget.tsx**: Được sử dụng cho script nhúng website khách hàng (`widget.js`).
*   **Kết luận**: Việc sửa đổi `ChatWidget.tsx` **KHÔNG** ảnh hưởng đến widget chat trên website của khách hàng. Chúng hoàn toàn tách biệt.

## Kế hoạch thực hiện

1.  **Tạo Edge Function mới: `merchant-ai`**:
    *   Tạo `supabase/functions/merchant-ai/index.ts`.
    *   **Logic**:
        *   Lấy API Key Admin từ `system_settings` (key: `admin_openai_api_key`).
        *   **System Prompt**:
            *   Vai trò: Chuyên gia hỗ trợ kỹ thuật hệ thống SmaxAI.
            *   Nhiệm vụ: Hướng dẫn sử dụng tính năng, giải thích cấu hình, hỗ trợ lỗi.
            *   Giới hạn: Chỉ trả lời về SmaxAI.
        *   **Kiến thức (Hardcoded context)**:
            *   Dashboard Overview: Chỉ số, biểu đồ.
            *   My Business: Cách nhập liệu sản phẩm, dịch vụ, booking slots (kể cả tính năng import CSV mới).
            *   Conversations: Cách chat với khách, xem AI logs.
            *   Settings: Cấu hình API key riêng, billing.
    *   **Không lưu DB**: Chat session chỉ tồn tại trên client (hoặc lưu local storage) để đơn giản hóa, không cần tạo bảng mới.

2.  **Cập nhật `ChatWidget.tsx` (Dành cho Merchant)**:
    *   Đổi tên hiển thị thành "SmaxAI Assistant".
    *   Thay đổi API endpoint: Gọi `merchant-ai` thay vì `chat`.
    *   Loại bỏ logic Supabase Realtime lắng nghe bảng `messages` (vì đây là chat với AI hệ thống, không phải khách hàng).
    *   Quản lý trạng thái tin nhắn (`messages`) cục bộ bằng React State.

3.  **Kiểm tra & Xác nhận**:
    *   Đảm bảo widget trong Dashboard hoạt động như một trợ lý ảo.
    *   Đảm bảo widget nhúng (nếu test thử) vẫn hoạt động bình thường với luồng cũ.

## Xác nhận
Kế hoạch này đảm bảo an toàn và tách biệt hoàn toàn hai luồng chat. Bạn có đồng ý triển khai không?