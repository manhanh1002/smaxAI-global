I have expanded the plan to include more detailed metrics as requested, focusing on revenue, cancellations, AI tasks, and customer growth.

### 1. Install Dependencies
- **Action**: Install `recharts` for data visualization.

### 2. Analytics Page Implementation (`/analytics`) - Expanded
I will rewrite `Analytics.tsx` with 4 comprehensive tabs:

#### **Tab 1: Overalls (General Health)**
- **KPI Cards**:
  - **Net Revenue**: Total income (excluding cancellations).
  - **Lost Revenue**: Potential revenue lost from cancellations.
  - **Global Cancellation Rate**: % of Orders + Bookings cancelled.
  - **Total Completed Tasks**: Total successful AI actions + Human actions.
- **Chart**: Revenue vs. Cancellation Value Trend.

#### **Tab 2: AI Performance (Deep Dive)**
- **KPI Cards**:
  - **AI Task Execution**: Total count of AI actions (bookings created, orders created, lookups).
  - **AI Automation Rate**: % of conversations handled fully by AI without human intervention.
  - **AI Revenue Contribution**: Revenue generated from AI-initiated transactions.
  - **Handover Rate**: % of conversations escalated to humans.
- **Chart**: AI Tasks by Type (Booking vs. Order vs. Support).

#### **Tab 3: Sales (Commercial Stats)**
- **KPI Cards**:
  - **Gross Merchandise Value (GMV)**: Total value of all orders.
  - **Order Cancellation Rate**: Specific to orders.
  - **Average Basket Size**: Avg items per order.
  - **Revenue per Customer**: Total Revenue / Unique Customers.
- **Chart**: Sales Performance (Completed vs. Cancelled).

#### **Tab 4: Interaction (Engagement)**
- **KPI Cards**:
  - **Total Message Volume**: Traffic intensity.
  - **User Retention**: % of users who sent messages on multiple days.
  - **New vs. Returning Visitors**: Ratio of new phone numbers/emails vs. existing ones.
- **Chart**: Peak Interaction Hours.

### 3. Enhanced Scorecards (Sub-pages)
I will add specific "Health & Growth" metrics to each section:

- **`/orders`**:
  - **Scorecards**: Total Orders, **Cancelled Orders**, **Net Revenue**, **Avg Order Value**.
  
- **`/bookings`**:
  - **Scorecards**: Total Bookings, **Cancelled Bookings**, **Show-up Rate** (Confirmed/Total), **Revenue from Services**.

- **`/customers`**:
  - **Scorecards**: Total Customers, **New Customers (This Month)**, **Active Customers** (Last 30 days), **Customer Lifetime Value (CLV)** (Avg).

### 4. Technical Approach
- **Data Fetching**:
  - **AI Tasks**: Count `messages` where `role='ai'` and `action_type` is not null.
  - **New Customers**: Filter `customers` by `created_at` within current month.
  - **Cancellations**: Filter `orders`/`bookings` by `status='cancelled'`.
- **Aggregation**: Perform efficient client-side calculation using `reduce` and `filter` on fetched datasets.
